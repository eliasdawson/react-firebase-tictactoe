<html>
<head>
  <title>Firebase React Tic Tac Toe</title>
  <script src="https://cdn.firebase.com/js/client/2.4.1/firebase.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>
  <style>
    .ttt-board {
    }

    .ttt-row {
      clear: left;
      height: 2em;
    }

    .ttt-space {
      border: 1px solid;
      float: left;
      height: 100%;
      line-height: 2em;
      width: 2em;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script type="text/jsx">

    var X = 'X';
    var O = 'O';

    var gameRef = new Firebase("https://blazing-inferno-190.firebaseio.com/-JqBmJEqKYiHdKFW8xg_/games/0");

    var Space = React.createClass({
      handleClick: function() {
        if ( this.props.data === '' ) {
          this.props.playFn(this.props.colIndex, this.props.rowIndex);  
        }
      },

      render: function() {
        return (
          <div className="ttt-space" onClick={this.handleClick}>{this.props.data}</div>
        );
      }
    });

    var BoardRow = React.createClass({
      render: function() {
        var spaces = this.props.data.map(function (space, index) {
          return (
            <Space data={space} rowIndex={this.props.rowIndex} colIndex={index} playFn={this.props.playFn}/>
          );
        }, this);

        return (
          <div className="ttt-row">
            {spaces}
          </div>
        );
      }
    });

    var Board = React.createClass({
      getInitialState: function() {
        return {
          board: [
            ['', '', ''],
            ['', '', ''],
            ['', '', '']
          ],
          player: X
        };
      },

      componentDidMount: function() {
        var self = this;
        gameRef.on('value', function(snapshot) {
          self.setState(snapshot.val());
        });
      },

      play: function(colIndex, rowIndex) {
        var state = this.state;
        state.board[rowIndex][colIndex] = state.player;
        state.player = (state.player === X) ? O : X;
        gameRef.set(state);
      },
      
      render: function() {
        var rows = this.state.board.map(function (row, index) {
          return (
            <BoardRow data={row} rowIndex={index} playFn={this.play}/>
          )
        }, this);

        return (
          <div className="ttt-board">
            {rows}
          </div>
        );
      }
    });

    React.render(
      <Board />,
      document.getElementById('app')
    );

    function resetGame() {
      gameRef.set({
          board: [
            ['', '', ''],
            ['', '', ''],
            ['', '', '']
          ],
          player: X
        });
    }
  </script>

</body>
</html>